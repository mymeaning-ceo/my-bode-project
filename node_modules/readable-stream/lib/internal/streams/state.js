'use strict';

function validateInteger(value, name) {
  if (typeof value !== 'number' || !Number.isInteger(value) || value < 0) {
    throw new RangeError(`${name} must be a non-negative integer`);
  }
}

function getHighWaterMark(state, options, duplexKey, isDuplex) {
  let hwm = options.highWaterMark;
  if (hwm != null) {
    validateInteger(hwm, isDuplex ? `options.${duplexKey}` : 'options.highWaterMark');
    return Math.floor(hwm);
  }
  if (isDuplex) {
    hwm = options[duplexKey];
    if (hwm != null) {
      validateInteger(hwm, `options.${duplexKey}`);
      return Math.floor(hwm);
    }
  }
  return state.objectMode ? 16 : 16 * 1024;
}

module.exports = {
  getHighWaterMark,
};
